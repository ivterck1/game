<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Squeak Squad - Remastered</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: #111;
            font-family: 'Arial', sans-serif;
            overflow: hidden;
            touch-action: none;
        }
        #game-container {
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 0 50px rgba(0,0,0,0.8);
        }
    </style>
</head>
<body>
    <div id="game-container"></div>

    <script>
    // ============================================
    // SISTEMA DE AUDIO
    // ============================================
    const gameInstance = { audioManager: null };

    class AudioManager {
        constructor() {
            this.ctx = null;
            this.initialized = false;
        }
        async init() {
            if (this.initialized) return;
            try {
                this.ctx = new (window.AudioContext || window.webkitAudioContext)();
                if (this.ctx.state === 'suspended') await this.ctx.resume();
                this.initialized = true;
            } catch (e) { console.warn("Audio error", e); }
        }
        playTone(freq, type = 'sine') {
            if (!this.initialized) return;
            const osc = this.ctx.createOscillator();
            const gain = this.ctx.createGain();
            osc.type = type;
            osc.frequency.setValueAtTime(freq, this.ctx.currentTime);
            gain.gain.setValueAtTime(0.3, this.ctx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + 0.3);
            osc.connect(gain);
            gain.connect(this.ctx.destination);
            osc.start();
            osc.stop(this.ctx.currentTime + 0.3);
        }
    }
    gameInstance.audioManager = new AudioManager();

    // ============================================
    // ESCENA TÍTULO
    // ============================================
    class TitleScene extends Phaser.Scene {
        constructor() { super({ key: 'TitleScene' }); }
        preload() { this.load.image('pato', 'pato.png'); } // Carga tu imagen aquí
        create() {
            // Fondo con degradado radial elegante
            const bg = this.add.graphics();
            bg.fillGradientStyle(0x2c3e50, 0x2c3e50, 0x000000, 0x000000, 1);
            bg.fillRect(0, 0, 800, 600);

            this.add.text(400, 200, 'SQUEAK\nSQUAD', {
                fontSize: '80px', fontFamily: 'Arial Black', color: '#FFF',
                align: 'center', stroke: '#000', strokeThickness: 10,
                shadow: { offsetX: 5, offsetY: 5, color: '#FF00DE', blur: 10, fill: true }
            }).setOrigin(0.5);

            const btn = this.add.container(400, 450);
            const btnBg = this.add.rectangle(0, 0, 300, 80, 0x00ffaa).setAlpha(0.8);
            const btnTxt = this.add.text(0, 0, 'JUGAR', { fontSize: '40px', fontFamily: 'Arial Black', color: '#000' }).setOrigin(0.5);
            btn.add([btnBg, btnTxt]);
            
            // Animación del botón
            this.tweens.add({ targets: btn, scale: 1.05, duration: 600, yoyo: true, repeat: -1 });

            btn.setInteractive(new Phaser.Geom.Rectangle(-150, -40, 300, 80), Phaser.Geom.Rectangle.Contains);
            btn.once('pointerdown', () => {
                gameInstance.audioManager.init();
                this.scene.start('GameScene');
            });
        }
    }

    // ============================================
    // ESCENA DE JUEGO
    // ============================================
    class GameScene extends Phaser.Scene {
        constructor() { super({ key: 'GameScene' }); }

        create() {
            // Fondo degradado (Azul baño brillante)
            const bg = this.add.graphics();
            bg.fillGradientStyle(0x4FACFE, 0x4FACFE, 0x00F2FE, 0x00F2FE, 1);
            bg.fillRect(0, 0, 800, 600);
            
            this.sequence = [];
            this.playerSequence = [];
            this.inputBlocked = true;
            this.round = 0;

            this.createDucks();
            
            // Texto de estado
            this.statusText = this.add.text(400, 100, 'PREPÁRATE', {
                fontSize: '40px', fontFamily: 'Arial Black', color: '#FFF',
                stroke: '#000', strokeThickness: 6
            }).setOrigin(0.5);

            this.time.delayedCall(1000, () => this.startRound());
        }

        createDucks() {
            // Colores vibrantes para los AROS, no para los patos
            const colors = [0xFF0055, 0x00AAFF, 0x00FF66, 0xFFAA00]; 
            const freqs = [300, 400, 500, 600];
            const xPositions = [160, 320, 480, 640];
            
            this.ducks = [];

            xPositions.forEach((x, i) => {
                const container = this.add.container(x, 350);

                // 1. EL ARO DE COLOR (Base)
                const ring = this.add.circle(0, 40, 55).setStrokeStyle(8, colors[i]);
                const glow = this.add.circle(0, 40, 50, colors[i], 0.3).setVisible(false); // Luz interior

                // 2. EL PATO (Imagen original blanca)
                // Ajustamos el origen al fondo (0.5, 1) para que al escalar "aplastado"
                // se aplaste contra el suelo y no desde el centro.
                const duckSprite = this.add.image(0, 50, 'pato').setOrigin(0.5, 1);
                duckSprite.setDisplaySize(110, 110); // Tamaño del pato

                // 3. EFECTO DE LUZ SOBRE EL PATO (Sutil)
                // Si quieres que el pato tenga un leve tinte del color del aro:
                // duckSprite.setTint(colors[i]); // Descomenta si prefieres tintado completo

                container.add([glow, ring, duckSprite]);
                
                // Guardamos referencias
                container.glow = glow;
                container.duck = duckSprite;
                container.freq = freqs[i];
                container.color = colors[i];

                // 4. ÁREA DE CLICK GIGANTE (SOLUCIÓN FUNCIONALIDAD)
                // Hacemos el área transparente más grande que el dibujo
                const hitArea = this.add.rectangle(0, 0, 140, 160, 0x000000, 0); 
                container.add(hitArea);
                
                hitArea.setInteractive({ useHandCursor: true });
                hitArea.on('pointerdown', () => this.handleInput(i));
                
                // Efecto hover (solo PC)
                hitArea.on('pointerover', () => duckSprite.y = 45);
                hitArea.on('pointerout', () => duckSprite.y = 50);

                this.ducks.push(container);
            });
        }

        startRound() {
            this.round++;
            this.statusText.setText('RONDA ' + this.round);
            this.sequence.push(Phaser.Math.Between(0, 3));
            this.playerSequence = [];
            
            this.time.delayedCall(800, () => this.playSequence());
        }

        playSequence() {
            this.inputBlocked = true;
            let i = 0;
            const speed = Math.max(300, 800 - (this.round * 40));

            const playNext = () => {
                if (i >= this.sequence.length) {
                    this.statusText.setText('¡TU TURNO!');
                    this.inputBlocked = false;
                    return;
                }
                this.activateDuck(this.sequence[i]);
                i++;
                this.time.delayedCall(speed, playNext);
            };
            playNext();
        }

        activateDuck(index) {
            const item = this.ducks[index];
            
            // 1. Sonido
            gameInstance.audioManager.playTone(item.freq);

            // 2. Visual: El aro brilla
            item.glow.setVisible(true);
            this.tweens.add({
                targets: item.glow, alpha: 0, duration: 400,
                onComplete: () => { item.glow.setVisible(false); item.glow.setAlpha(0.3); }
            });

            // 3. Visual: Squash & Stretch (El "Jugo")
            // El pato se estira hacia arriba y luego vuelve
            this.tweens.add({
                targets: item.duck,
                scaleY: 1.2, // Se estira
                scaleX: 0.8, // Se adelgaza
                y: 30,       // Salta un poco
                duration: 100,
                yoyo: true,
                ease: 'Quad.easeOut'
            });
        }

        handleInput(index) {
            if (this.inputBlocked) return;

            this.activateDuck(index);
            
            const expected = this.sequence[this.playerSequence.length];
            if (index === expected) {
                this.playerSequence.push(index);
                if (this.playerSequence.length === this.sequence.length) {
                    this.inputBlocked = true;
                    this.statusText.setText('¡BIEN!');
                    this.time.delayedCall(1000, () => this.startRound());
                }
            } else {
                this.inputBlocked = true;
                this.cameras.main.shake(300, 0.02); // Temblor de pantalla
                gameInstance.audioManager.playTone(150, 'sawtooth');
                this.statusText.setText('¡ERROR!');
                this.time.delayedCall(1500, () => this.scene.start('TitleScene'));
            }
        }
    }

    const config = {
        type: Phaser.AUTO,
        scale: {
            mode: Phaser.Scale.FIT,
            autoCenter: Phaser.Scale.CENTER_BOTH,
            width: 800,
            height: 600
        },
        scene: [TitleScene, GameScene]
    };

    new Phaser.Game(config);
    </script>
</body>
</html>