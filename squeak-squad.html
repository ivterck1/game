<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Squeak Squad - Juego de Ritmo y Memoria</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            font-family: 'Arial', sans-serif;
            overflow: hidden;
            touch-action: none; /* Crucial para mÃ³viles */
        }
        #game-container {
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }
    </style>
</head>
<body>
    <div id="game-container"></div>

    <script>
    // ============================================
    // CONFIGURACIÃ“N GLOBAL
    // ============================================
    const gameInstance = {
        audioManager: null,
        currentScene: null
    };

    // ============================================
    // SISTEMA DE AUDIO
    // ============================================
    class AudioManager {
        constructor() {
            this.audioContext = null;
            this.initialized = false;
        }

        async init() {
            try {
                if (!this.audioContext) {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                }
                if (this.audioContext.state === 'suspended') {
                    await this.audioContext.resume();
                }
                this.initialized = true;
                return true;
            } catch (e) {
                console.warn("Audio no pudo iniciarse:", e);
                return false;
            }
        }

        playQuack(frequency, duration = 0.3) {
            if (!this.initialized || !this.audioContext) return;
            try {
                const ctx = this.audioContext;
                const oscillator = ctx.createOscillator();
                const gainNode = ctx.createGain();

                oscillator.type = 'square';
                oscillator.frequency.setValueAtTime(frequency, ctx.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(frequency * 0.5, ctx.currentTime + duration * 0.3);

                gainNode.gain.setValueAtTime(0.4, ctx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0, ctx.currentTime + duration);

                oscillator.connect(gainNode);
                gainNode.connect(ctx.destination);

                oscillator.start(ctx.currentTime);
                oscillator.stop(ctx.currentTime + duration);
            } catch (e) { console.error("Error audio", e); }
        }

        playError() {
            if (!this.initialized || !this.audioContext) return;
            try {
                const ctx = this.audioContext;
                const oscillator = ctx.createOscillator();
                const gainNode = ctx.createGain();

                oscillator.type = 'sawtooth';
                oscillator.frequency.setValueAtTime(150, ctx.currentTime);
                oscillator.frequency.linearRampToValueAtTime(50, ctx.currentTime + 0.5);

                gainNode.gain.setValueAtTime(0.5, ctx.currentTime);
                gainNode.gain.linearRampToValueAtTime(0, ctx.currentTime + 0.5);

                oscillator.connect(gainNode);
                gainNode.connect(ctx.destination);

                oscillator.start(ctx.currentTime);
                oscillator.stop(ctx.currentTime + 0.5);
            } catch (e) {}
        }

        getFrequencies() {
            return [523.25, 659.25, 783.99, 1046.50];
        }
    }

    gameInstance.audioManager = new AudioManager();

    // ============================================
    // ESCENA DE TÃTULO
    // ============================================
    class TitleScene extends Phaser.Scene {
        constructor() { super({ key: 'TitleScene' }); }

        create() {
            this.add.rectangle(400, 300, 800, 600, 0x87CEEB); 
            
            // TÃ­tulo
            this.add.text(400, 200, 'SQUEAK SQUAD', {
                fontSize: '64px', fontFamily: 'Arial Black', color: '#FFD700', stroke: '#FF6B35', strokeThickness: 8
            }).setOrigin(0.5);

            // BotÃ³n
            const startButton = this.add.container(400, 400);
            const bg = this.add.rectangle(0, 0, 280, 70, 0xFF6B35).setStrokeStyle(4, 0xFFFFFF);
            const txt = this.add.text(0, 0, 'TAP TO QUACK', { fontSize: '28px', fontFamily: 'Arial Black' }).setOrigin(0.5);
            startButton.add([bg, txt]);

            // AnimaciÃ³n botÃ³n
            this.tweens.add({ targets: startButton, scale: 1.05, duration: 500, yoyo: true, repeat: -1 });

            // InteracciÃ³n
            startButton.setInteractive(new Phaser.Geom.Rectangle(-140, -35, 280, 70), Phaser.Geom.Rectangle.Contains);
            
            startButton.once('pointerdown', () => {
                gameInstance.audioManager.init().catch(e => console.log(e));
                gameInstance.audioManager.playQuack(523.25);
                
                this.tweens.add({
                    targets: startButton, scale: 0.9, duration: 100, yoyo: true,
                    onComplete: () => this.scene.start('GameScene')
                });
            });

            // --- DETECCIÃ“N DE MÃ“VIL CORRECTA ---
            if (!this.sys.game.device.os.desktop) {
                const mobileMsg = this.add.text(400, 550, 'ðŸ“± MEJOR EXPERIENCIA: GIRA TU MÃ“VIL ðŸ”„', {
                    fontSize: '20px',
                    fontFamily: 'Arial',
                    color: '#ffffff',
                    backgroundColor: '#00000088',
                    padding: { x: 10, y: 5 }
                }).setOrigin(0.5);

                this.tweens.add({
                    targets: mobileMsg,
                    alpha: 0.2,
                    duration: 800,
                    yoyo: true,
                    repeat: -1
                });
            }
        }
    }

    // ============================================
    // ESCENA DE JUEGO
    // ============================================
   // ============================================
    // ESCENA DE JUEGO (MODIFICADA CON IMÃGENES)
    // ============================================
    class GameScene extends Phaser.Scene {
        constructor() { super({ key: 'GameScene' }); }

        // 1. CARGAMOS LA IMAGEN AQUÃ
        preload() {
            // Carga la imagen 'pato.png' que debe estar junto a tu HTML.
            // Si no tienes imagen aÃºn, Phaser pondrÃ¡ un cuadro verde de error (es normal).
            this.load.image('pato', 'pato.png'); 
        }

        create() {
            gameInstance.currentScene = this;
            this.sequence = [];
            this.playerSequence = [];
            this.round = 0; 
            this.inputBlocked = true;

            this.createBackground();
            this.createDucks();
            this.createUI();

            this.time.delayedCall(1000, () => this.startRound());
        }

        createBackground() {
            this.add.rectangle(400, 300, 800, 600, 0x87CEEB);
        }

        // 2. AQUÃ PONEMOS LA IMAGEN EN LUGAR DE LAS FORMAS
        createDucks() {
            const colors = [0xFF6B6B, 0x4ECDC4, 0x95E17C, 0xC77DFF];
            const xPositions = [200, 333, 466, 600];
            this.ducks = [];

            xPositions.forEach((x, i) => {
                const container = this.add.container(x, 320);
                
                // --- CAMBIO: Usamos imagen en vez de formas geomÃ©tricas ---
                
                // Brillo (lo dejamos porque se ve bien detrÃ¡s de la imagen)
                const glow = this.add.circle(0, 0, 60, colors[i], 0.4).setVisible(false);

                // La imagen del pato
                const duckSprite = this.add.image(0, 0, 'pato');
                
                // Ajustamos el tamaÃ±o de la imagen (escalala si es muy grande)
                duckSprite.setDisplaySize(100, 100); 

                // TeÃ±imos la imagen con el color correspondiente
                // (Para que esto funcione bien, tu pato original debe ser BLANCO)
                duckSprite.setTint(colors[i]);

                container.add([glow, duckSprite]);
                // ----------------------------------------------------------

                container.glow = glow; 
                container.setSize(80, 80);
                
                container.setInteractive(new Phaser.Geom.Rectangle(-40, -40, 80, 80), Phaser.Geom.Rectangle.Contains);
                container.on('pointerdown', () => this.handleInput(i));
                
                this.ducks.push(container);
            });
        }

        createUI() {
            this.roundText = this.add.text(700, 50, 'Ronda: 1', { fontSize: '24px', fontFamily: 'Arial Black', color: '#333' }).setOrigin(0.5);
            this.statusText = this.add.text(400, 500, 'Â¡OBSERVA!', { fontSize: '32px', fontFamily: 'Arial Black', color: '#FF6B35' }).setOrigin(0.5);
        }

        startRound() {
            this.round++;
            this.roundText.setText('Ronda: ' + this.round);
            this.sequence.push(Phaser.Math.Between(0, 3));
            this.playerSequence = [];
            this.playSequence();
        }

        playSequence() {
            this.inputBlocked = true;
            this.statusText.setText('Â¡OBSERVA!');
            
            let i = 0;
            const speed = Math.max(300, 1000 - (this.round * 50));

            const playNext = () => {
                if (i >= this.sequence.length) {
                    this.time.delayedCall(500, () => {
                        this.inputBlocked = false;
                        this.statusText.setText('Â¡TU TURNO!');
                    });
                    return;
                }
                
                this.activateDuck(this.sequence[i]);
                i++;
                this.time.delayedCall(speed, playNext);
            };

            playNext();
        }

        activateDuck(index) {
            const duck = this.ducks[index];
            if (!duck) return;

            duck.glow.setVisible(true);
            this.tweens.add({
                targets: duck,
                y: 280, 
                duration: 150,
                yoyo: true,
                onComplete: () => duck.glow.setVisible(false)
            });

            try {
                gameInstance.audioManager.playQuack(gameInstance.audioManager.getFrequencies()[index]);
            } catch(e) {}
        }

        handleInput(index) {
            if (this.inputBlocked) return;
            this.activateDuck(index);

            const expected = this.sequence[this.playerSequence.length];
            
            if (index === expected) {
                this.playerSequence.push(index);
                if (this.playerSequence.length === this.sequence.length) {
                    this.inputBlocked = true;
                    this.statusText.setText('Â¡BIEN HECHO!');
                    this.time.delayedCall(1000, () => this.startRound());
                }
            } else {
                this.gameOver();
            }
        }

        gameOver() {
            this.inputBlocked = true;
            gameInstance.audioManager.playError();
            this.scene.start('GameOverScene', { score: this.round });
        }
    }
    // ============================================
    // ESCENA GAME OVER
    // ============================================
    class GameOverScene extends Phaser.Scene {
        constructor() { super({ key: 'GameOverScene' }); }
        
        create(data) {
            this.add.rectangle(400, 300, 800, 600, 0x222222);
            this.add.text(400, 200, 'GAME OVER', { fontSize: '64px', color: '#FF4444', fontFamily: 'Arial Black' }).setOrigin(0.5);
            this.add.text(400, 300, 'Ronda alcanzada: ' + data.score, { fontSize: '32px', color: '#FFF' }).setOrigin(0.5);
            
            const btn = this.add.text(400, 450, 'INTENTAR DE NUEVO', { fontSize: '28px', backgroundColor: '#4CAF50', padding: {x:20, y:10} }).setOrigin(0.5);
            btn.setInteractive({ useHandCursor: true });
            btn.on('pointerdown', () => this.scene.start('GameScene'));
        }
    }

    // ============================================
    // INICIALIZACIÃ“N DE PHASER
    // ============================================
    const config = {
        type: Phaser.AUTO,
        scale: {
            mode: Phaser.Scale.FIT,
            autoCenter: Phaser.Scale.CENTER_BOTH,
            width: 800,
            height: 600,
        },
        parent: 'game-container',
        scene: [TitleScene, GameScene, GameOverScene]
    };

    new Phaser.Game(config);
    </script>
</body>
</html>