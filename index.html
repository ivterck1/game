<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Gravedad Inversa - Cyberpunk Runner</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body {
            background: #0a0a0f;
            width: 100%;
            height: 100%;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: Arial, sans-serif;
            user-select: none;
            -webkit-user-select: none;
        }
        #game-wrapper {
            position: relative;
            width: 100%;
            height: 100%;
            max-width: 450px;
            max-height: 800px;
            box-shadow: 0 0 50px rgba(0, 255, 255, 0.1);
        }
        /* Pantalla de carga */
        #loading-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0a0a0f 0%, #1a1a2e 50%, #0a0a0f 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }
        .loading-title {
            font-size: 2rem;
            font-weight: bold;
            background: linear-gradient(90deg, #ff00ff, #00ffff, #ff00ff);
            background-size: 200% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradient-shift 2s linear infinite;
            text-align: center;
            margin-bottom: 15px;
            line-height: 1.3;
        }
        .loading-subtitle { color: #00ffff; font-size: 0.8rem; margin-bottom: 30px; text-transform: uppercase; letter-spacing: 4px; }
        .loading-bar-container { width: 150px; height: 3px; background: #1a1a2e; border-radius: 2px; overflow: hidden; }
        .loading-bar { width: 0%; height: 100%; background: linear-gradient(90deg, #ff00ff, #00ffff); border-radius: 2px; transition: width 0.2s ease; }
        .loading-percent { color: #888; font-size: 0.7rem; margin-top: 10px; font-family: monospace; }
        @keyframes gradient-shift { 0% { background-position: 0% center; } 100% { background-position: 200% center; } }
    </style>
</head>
<body>
    <div id="game-wrapper">
        <div id="loading-screen">
            <div class="loading-title">GRAVEDAD<br>INVERSA</div>
            <div class="loading-subtitle">Cyberpunk Runner</div>
            <div class="loading-bar-container">
                <div class="loading-bar" id="loading-bar"></div>
            </div>
            <div class="loading-percent" id="loading-percent">0%</div>
        </div>
        <canvas id="game-canvas" style="display: none;"></canvas>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>
    <script>
        // ========================================
        // 1. GESTOR DE AUDIO
        // ========================================
        class AudioManager {
            constructor() {
                this.ctx = null;
                this.master = null;
                this.musicPlaying = false;
                this.bassOsc = null;
                this.bassInterval = null;
                this.melodyTimeout = null;
            }

            init() {
                if (this.ctx) return;
                const AC = window.AudioContext || window.webkitAudioContext;
                this.ctx = new AC();
                this.master = this.ctx.createGain();
                this.master.gain.value = 0.35;
                this.master.connect(this.ctx.destination);
            }

            playTone(type, freq, duration, vol, slideTo = null) {
                if (!this.ctx) return;
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                osc.type = type;
                osc.frequency.setValueAtTime(freq, this.ctx.currentTime);
                if (slideTo) osc.frequency.exponentialRampToValueAtTime(slideTo, this.ctx.currentTime + duration);
                gain.gain.setValueAtTime(vol, this.ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + duration);
                osc.connect(gain);
                gain.connect(this.master);
                osc.start();
                osc.stop(this.ctx.currentTime + duration);
            }

            playGravity() { this.playTone('sawtooth', 150, 0.15, 0.2, 300); }
            playDeath() { this.playTone('sawtooth', 200, 0.5, 0.3, 50); }
            playScore() { 
                this.playTone('square', 800, 0.1, 0.1); 
                setTimeout(() => this.playTone('square', 1200, 0.1, 0.1), 80);
            }
            playCollect() {
                this.playTone('sine', 1200, 0.1, 0.2);
                setTimeout(() => this.playTone('sine', 1800, 0.2, 0.2), 50);
            }
            playShield() { // Sonido PowerUp
                this.playTone('sine', 400, 0.3, 0.2, 800);
                setTimeout(() => this.playTone('square', 600, 0.3, 0.1, 1000), 100);
            }
            playSmash() { // Sonido romper obst치culo
                this.playTone('sawtooth', 100, 0.1, 0.3, 50);
            }

            startMusic() {
                if (!this.ctx || this.musicPlaying) return;
                this.musicPlaying = true;
                const bassFreq = 55;
                
                this.bassOsc = this.ctx.createOscillator();
                this.bassOsc.type = 'triangle';
                this.bassOsc.frequency.value = bassFreq;
                const bGain = this.ctx.createGain();
                bGain.gain.value = 0.3;
                this.bassOsc.connect(bGain);
                bGain.connect(this.master);
                this.bassOsc.start();

                this.bassInterval = setInterval(() => {
                    if (this.musicPlaying && this.bassOsc) {
                        this.bassOsc.frequency.setValueAtTime(bassFreq + Math.sin(this.ctx.currentTime * 4) * 5, this.ctx.currentTime);
                    }
                }, 50);

                const notes = [220, 261, 329, 261, 220, 196, 220, 0];
                let idx = 0;
                const loop = () => {
                    if (!this.musicPlaying) return;
                    const n = notes[idx % notes.length];
                    if (n > 0) this.playTone('square', n, 0.15, 0.05);
                    idx++;
                    this.melodyTimeout = setTimeout(loop, 250);
                };
                loop();
            }

            stopMusic() {
                this.musicPlaying = false;
                if (this.bassOsc) { try { this.bassOsc.stop(); } catch(e){} this.bassOsc = null; }
                clearInterval(this.bassInterval);
                clearTimeout(this.melodyTimeout);
            }
        }
        const audio = new AudioManager();

        // ========================================
        // 2. TEXTURAS Y GR츼FICOS
        // ========================================
        function genTextures(scene) {
            const make = (k, w, h, fn) => {
                const g = scene.make.graphics({ add: false });
                fn(g);
                g.generateTexture(k, w, h);
            };

            // GEMA
            make('gem', 30, 30, g => {
                g.fillStyle(0xffffff, 1); 
                g.beginPath();
                g.moveTo(15, 0); g.lineTo(30, 15); g.lineTo(15, 30); g.lineTo(0, 15);
                g.closePath();
                g.fillPath();
                g.lineStyle(2, 0x000000, 0.5); g.strokePath();
            });

            // ESCUDO ITEM (Anillo)
            make('shield_item', 40, 40, g => {
                g.lineStyle(4, 0x00ffff, 1);
                g.strokeCircle(20, 20, 15);
                g.fillStyle(0x00ffff, 0.3);
                g.fillCircle(20, 20, 10);
            });

            // AURA ESCUDO (Jugador)
            make('shield_aura', 60, 60, g => {
                g.lineStyle(2, 0x00ffff, 1);
                g.strokeCircle(30, 30, 28);
                g.fillStyle(0x00ffff, 0.2);
                g.fillCircle(30, 30, 28);
            });

            // Fondo
            make('bg', 450, 800, g => {
                g.fillStyle(0x0a0a0f, 1); g.fillRect(0,0,450,800);
                for(let i=0; i<20; i++) {
                    const h = Phaser.Math.Between(50, 250);
                    const c = Phaser.Display.Color.GetColor(20, 20, 40 + h/5);
                    g.fillStyle(c, 1); g.fillRect(i*25, 800-h, 24, h);
                    g.fillStyle(0xffffff, 0.1);
                    if(Math.random()>0.5) g.fillRect(i*25+8, 800-h+10, 4, 8);
                }
            });

            // Rejilla
            make('fg', 450, 800, g => {
                g.lineStyle(1, 0xffffff, 0.1);
                for(let i=0; i<800; i+=40) g.lineBetween(0,i,450,i);
                for(let i=0; i<450; i+=40) g.lineBetween(i,0,i,800);
            });

            // Jugador
            make('player', 40, 40, g => {
                g.fillStyle(0xffffff, 1); g.fillCircle(20,20,20);
                g.fillStyle(0x000000, 1); g.fillCircle(20,20,15);
                g.fillStyle(0xffffff, 1); g.fillRect(14,16,5,3); g.fillRect(21,16,5,3);
            });

            // Obst치culos
            make('obs_top', 40, 120, g => {
                g.fillStyle(0xffffff, 1); g.fillRect(0,0,40,120);
                g.fillStyle(0x000000, 1); g.fillRect(3,3,34,114);
            });
            make('obs_bot', 40, 120, g => {
                g.fillStyle(0xffffff, 1); g.fillRect(0,0,40,120);
                g.fillStyle(0x000000, 1); g.fillRect(3,3,34,114);
            });
        }

        // ========================================
        // 3. INTRO SCENE
        // ========================================
        class IntroScene extends Phaser.Scene {
            constructor() { super('IntroScene'); }
            create() {
                const cx = 225, cy = 400;
                this.add.rectangle(cx, cy, 450, 800, 0x2a004f); // Fondo Morado
                
                // Rayos
                const sun = this.add.graphics({ x: cx, y: cy });
                sun.fillStyle(0xff00ff, 0.1);
                for(let i=0; i<12; i++) {
                    sun.slice(0,0,600, Phaser.Math.DegToRad(i*30), Phaser.Math.DegToRad(i*30+15));
                    sun.fillPath();
                }
                this.tweens.add({ targets: sun, angle: 360, duration: 8000, repeat: -1 });

                // T칤tulos
                const t1 = this.add.text(cx, 200, 'GRAVEDAD', { fontSize: '52px', fontFamily: 'Arial Black', color: '#00ffff', stroke: '#2a004f', strokeThickness: 8 }).setOrigin(0.5).setScale(0);
                const t2 = this.add.text(cx, 260, 'INVERSA', { fontSize: '68px', fontFamily: 'Arial Black', color: '#ff006e', stroke: '#ffffff', strokeThickness: 6 }).setOrigin(0.5).setScale(0);
                
                this.tweens.add({ targets: t1, scale: 1, ease: 'Bounce', duration: 600, delay: 100 });
                this.tweens.add({ targets: t2, scale: 1, ease: 'Bounce', duration: 600, delay: 300 });

                // Bot칩n Start
                const start = this.add.text(cx, 650, '> TOCA PARA INICIAR <', { fontSize: '20px', fontFamily: 'Arial Black', color: '#ffffff' }).setOrigin(0.5);
                this.tweens.add({ targets: start, alpha: 0.2, duration: 600, yoyo: true, repeat: -1 });

                const go = () => {
                    this.cameras.main.flash(300, 255, 0, 255);
                    setTimeout(() => this.scene.start('GameScene'), 300);
                };
                this.input.once('pointerdown', go);
                this.input.keyboard.once('keydown-SPACE', go);
            }
        }

        // ========================================
        // 4. JUEGO (6 ZONAS + GEMAS + ESCUDO)
        // ========================================
        class GameScene extends Phaser.Scene {
            constructor() { super('GameScene'); }
            preload() { genTextures(this); }
            
            create() {
                this.speed = 300;
                this.score = 0;
                this.dist = 0;
                this.gemCount = 0;
                this.inv = false;
                this.over = false;
                this.obs = [];
                this.gems = [];
                this.shields = []; // Array items escudo
                this.lastSpawn = 0;
                
                // Sistema de Escudo
                this.shieldActive = false;
                this.shieldTimer = null;
                
                // Nivel inicial
                this.currentLevel = 1; 

                // Capas
                this.bg = this.add.tileSprite(225, 400, 450, 800, 'bg');
                this.fg = this.add.tileSprite(225, 400, 450, 800, 'fg').setAlpha(0.4);
                
                this.lineTop = this.add.rectangle(225, 20, 450, 4, 0xff00ff).setDepth(2);
                this.lineBot = this.add.rectangle(225, 780, 450, 4, 0x00ffff).setDepth(2);

                // Jugador
                this.player = this.add.sprite(80, 740, 'player').setDepth(10);
                this.player.setTint(0xff00ff); 
                this.baseY = 740;
                this.floatY = 0;

                // Visual del Escudo (Aura)
                this.shieldAura = this.add.sprite(80, 740, 'shield_aura').setDepth(11).setAlpha(0);

                // Estela
                this.time.addEvent({ delay: 50, loop: true, callback: () => {
                    if(this.over) return;
                    const g = this.add.sprite(this.player.x, this.player.y, 'player')
                        .setOrigin(0.5).setAlpha(0.4).setTint(this.player.tintTopLeft).setScale(1, this.player.scaleY).setDepth(9);
                    this.tweens.add({ targets: g, alpha: 0, scale: 0, duration: 300, onComplete: () => g.destroy() });
                }});

                // UI
                const uiX = 430;
                this.scoreTxt = this.add.text(uiX, 40, '0m', { fontSize: '28px', fontFamily: 'Arial Black', color: '#ff00ff', align: 'right' }).setOrigin(1, 0).setDepth(20);
                this.add.text(uiX, 70, 'DISTANCIA', { fontSize: '10px', color: '#00ffff' }).setOrigin(1, 0).setDepth(20);
                this.gemTxt = this.add.text(20, 40, '游눑 0', { fontSize: '24px', fontFamily: 'Arial Black', color: '#00ff00' }).setDepth(20);

                // Controles
                this.input.on('pointerdown', () => this.flip());
                this.input.keyboard.on('keydown-SPACE', () => this.flip());

                audio.init();
                audio.startMusic();
            }

            update(time, delta) {
                if (this.over) return;

                this.bg.tilePositionX += this.speed * delta / 1000 * 0.2;
                this.fg.tilePositionX += this.speed * delta / 1000 * 0.5;

                this.floatY += 0.005 * delta;
                this.player.y = this.baseY + Math.sin(this.floatY) * 5;
                
                // Mover Aura con jugador
                if (this.shieldActive) {
                    this.shieldAura.x = this.player.x;
                    this.shieldAura.y = this.player.y;
                    this.shieldAura.angle += 2; // Rotaci칩n efecto
                }

                this.dist += (this.speed * delta / 1000) / 5;
                this.score = Math.floor(this.dist);
                this.scoreTxt.setText(this.score + 'm');
                this.speed += 0.03 * (delta/16);

                this.checkLevelProgression();

                if (time - this.lastSpawn > 1800 - Math.min(this.score*2, 800)) {
                    this.spawnObs();
                    this.lastSpawn = time;
                }

                this.updateEntities(delta);

                if(this.player.y < 45) this.player.y = 45;
                if(this.player.y > 755) this.player.y = 755;
            }

            checkLevelProgression() {
                if (this.score >= 500 && this.currentLevel === 1) { this.currentLevel = 2; this.levelUpEffect("ALERTA ROJA", 0xff0000, 0xffaa00); }
                else if (this.score >= 1000 && this.currentLevel === 2) { this.currentLevel = 3; this.levelUpEffect("ZONA MATRIX", 0x00ff00, 0x003300); }
                else if (this.score >= 1500 && this.currentLevel === 3) { this.currentLevel = 4; this.levelUpEffect("EDAD DE ORO", 0xffd700, 0xffaa00); }
                else if (this.score >= 2000 && this.currentLevel === 4) { this.currentLevel = 5; this.levelUpEffect("CERO ABSOLUTO", 0x00ffff, 0x0000ff); }
                else if (this.score >= 2500 && this.currentLevel === 5) { this.currentLevel = 6; this.levelUpEffect("EL VAC칈O", 0xffffff, 0x000000); }
            }

            levelUpEffect(text, c1, c2) {
                this.cameras.main.flash(500, 255, 255, 255);
                this.applyPalette(c1, c2);
                const lvlText = this.add.text(225, 300, text, {
                    fontSize: '42px', fontFamily: 'Arial Black', color: '#ffffff', stroke: '#000000', strokeThickness: 6, align: 'center'
                }).setOrigin(0.5).setDepth(30).setScale(0);
                this.tweens.add({
                    targets: lvlText, scale: 1.2, alpha: 0, duration: 2500, ease: 'Power2',
                    onComplete: () => lvlText.destroy()
                });
                audio.playCollect();
            }

            applyPalette(c1, c2) {
                this.bg.setTint(c2);
                this.fg.setTint(c1);
                this.lineTop.setFillStyle(c1);
                this.lineBot.setFillStyle(c1);
                this.scoreTxt.setColor('#' + c1.toString(16).padStart(6, '0'));
                this.player.setTint(c1);
                this.obs.forEach(o => o.setTint(c1));
                this.gems.forEach(g => g.setTint(c1));
            }

            spawnObs() {
                const isTop = Math.random() > 0.5;
                const h = Phaser.Math.Between(80, 180);
                const y = isTop ? 30 + h/2 : 770 - h/2;
                
                const obs = this.add.sprite(500, y, isTop ? 'obs_top' : 'obs_bot').setAlpha(0).setDepth(5);
                
                let tint = 0xff00ff;
                if (this.currentLevel === 2) tint = 0xff0000;
                else if (this.currentLevel === 3) tint = 0x00ff00;
                else if (this.currentLevel === 4) tint = 0xffd700;
                else if (this.currentLevel === 5) tint = 0x00ffff;
                else if (this.currentLevel === 6) tint = 0xffffff;

                obs.setTint(tint);
                if (h < 100) obs.setScale(1, h/120);
                this.tweens.add({ targets: obs, alpha: 1, duration: 200 });
                this.obs.push(obs);

                // L칩gica de Spawn de 칈tems
                const rand = Math.random();
                if(rand < 0.05) { // 5% Probabilidad ESCUDO
                    const itemY = isTop ? 700 : 100;
                    const shield = this.add.sprite(500 + Phaser.Math.Between(0, 50), itemY, 'shield_item').setDepth(6);
                    this.tweens.add({ targets: shield, scale: 1.2, yoyo: true, repeat: -1, duration: 500 });
                    this.shields.push(shield);
                } else if (rand < 0.45) { // 40% Probabilidad GEMA
                    const itemY = isTop ? 700 : 100;
                    const gem = this.add.sprite(500 + Phaser.Math.Between(0, 50), itemY, 'gem').setDepth(6);
                    gem.setTint(tint);
                    this.tweens.add({ targets: gem, angle: 360, duration: 2000, repeat: -1 });
                    this.gems.push(gem);
                }
            }

            updateEntities(delta) {
                const move = (this.speed + this.score * 0.2) * delta / 1000;

                // OBST츼CULOS
                for (let i = this.obs.length - 1; i >= 0; i--) {
                    const o = this.obs[i];
                    o.x -= move;
                    if (o.x < -50) { o.destroy(); this.obs.splice(i, 1); continue; }
                    
                    if (Math.abs(this.player.x - o.x) < 30 && Math.abs(this.player.y - o.y) < (o.displayHeight/2 + 15)) {
                        if (this.shieldActive) {
                            // ROMPER OBST츼CULO
                            this.smashObstacle(o);
                            this.obs.splice(i, 1);
                        } else {
                            this.gameOver();
                        }
                    }
                }

                // GEMAS
                for (let i = this.gems.length - 1; i >= 0; i--) {
                    const g = this.gems[i];
                    g.x -= move;
                    if (g.x < -50) { g.destroy(); this.gems.splice(i, 1); continue; }
                    if (Math.abs(this.player.x - g.x) < 40 && Math.abs(this.player.y - g.y) < 50) {
                        this.collectGem(g, i);
                    }
                }

                // ESCUDOS
                for (let i = this.shields.length - 1; i >= 0; i--) {
                    const s = this.shields[i];
                    s.x -= move;
                    if (s.x < -50) { s.destroy(); this.shields.splice(i, 1); continue; }
                    if (Math.abs(this.player.x - s.x) < 40 && Math.abs(this.player.y - s.y) < 50) {
                        this.activateShield(s, i);
                    }
                }
            }

            smashObstacle(obs) {
                audio.playSmash();
                this.cameras.main.shake(100, 0.01);
                
                // Part칤culas explosi칩n
                for(let k=0; k<8; k++) {
                    const p = this.add.rectangle(obs.x, obs.y, 8, 8, obs.tintTopLeft);
                    this.tweens.add({
                        targets: p,
                        x: p.x + Phaser.Math.Between(-50, 50),
                        y: p.y + Phaser.Math.Between(-50, 50),
                        alpha: 0, rotation: 5, duration: 400,
                        onComplete: () => p.destroy()
                    });
                }
                obs.destroy();
            }

            activateShield(sprite, index) {
                sprite.destroy();
                this.shields.splice(index, 1);
                
                audio.playShield();
                this.shieldActive = true;
                this.shieldAura.setAlpha(1);
                this.shieldAura.setTint(0x00ffff);
                
                // Texto flotante
                const txt = this.add.text(this.player.x, this.player.y - 50, 'ESCUDO!', { fontSize: '16px', fontFamily: 'Arial Black', color: '#00ffff' }).setOrigin(0.5);
                this.tweens.add({ targets: txt, y: txt.y - 50, alpha: 0, duration: 800, onComplete: () => txt.destroy() });

                // Reiniciar temporizador si ya ten칤as escudo
                if (this.shieldTimer) this.shieldTimer.remove();

                // Parpadeo final
                this.time.delayedCall(4000, () => {
                    if (this.shieldActive) {
                        this.tweens.add({ targets: this.shieldAura, alpha: 0.2, yoyo: true, repeat: 10, duration: 100 });
                    }
                });

                // Apagar escudo
                this.shieldTimer = this.time.delayedCall(6000, () => {
                    this.shieldActive = false;
                    this.shieldAura.setAlpha(0);
                });
            }

            collectGem(gem, index) {
                audio.playCollect();
                this.gemCount++;
                this.dist += 50;
                this.gemTxt.setText('游눑 ' + this.gemCount);
                
                const popup = this.add.text(gem.x, gem.y, '+50m', { fontSize: '20px', fontFamily: 'Arial Black', color: '#ffffff', stroke: '#000', strokeThickness: 4 }).setOrigin(0.5);
                this.tweens.add({ targets: popup, y: popup.y - 50, alpha: 0, duration: 600, onComplete: () => popup.destroy() });

                const p = this.add.circle(gem.x, gem.y, 20, gem.tintTopLeft, 0.6);
                this.tweens.add({ targets: p, scale: 2, alpha: 0, duration: 300, onComplete: () => p.destroy() });

                gem.destroy();
                this.gems.splice(index, 1);
            }

            flip() {
                if (this.over) return;
                this.inv = !this.inv;
                this.baseY = this.inv ? 60 : 740;
                this.cameras.main.shake(80, 0.004);
                this.tweens.add({ targets: this.player, scaleY: -1, duration: 100 });
                audio.playGravity();
                
                const pColor = this.player.tintTopLeft;
                for(let i=0; i<5; i++) {
                    const p = this.add.circle(this.player.x, this.player.y, 4, pColor, 1);
                    this.tweens.add({ targets: p, x: p.x + Phaser.Math.Between(-20,20), y: p.y + Phaser.Math.Between(-20,20), alpha: 0, duration: 400 });
                }
            }

            gameOver() {
                this.over = true;
                audio.stopMusic();
                audio.playDeath();
                this.cameras.main.shake(300, 0.02);
                this.player.setVisible(false);
                this.shieldAura.setAlpha(0);
                
                const cx = 225, cy = 400;

                this.add.rectangle(cx, cy, 450, 800, 0x2a004f, 0.95).setDepth(50);
                
                const sun = this.add.graphics({ x: cx, y: cy });
                sun.setDepth(50);
                sun.fillStyle(0xff00ff, 0.15);
                for(let i=0; i<12; i++) {
                    sun.slice(0, 0, 600, Phaser.Math.DegToRad(i*30), Phaser.Math.DegToRad(i*30+15));
                    sun.fillPath();
                }
                this.tweens.add({ targets: sun, angle: 360, duration: 8000, repeat: -1, ease: 'Linear' });

                const title = this.add.text(cx, 250, 'GAME\nOVER', { 
                    fontSize: '70px', fontFamily: 'Arial Black', align: 'center', 
                    color: '#ff006e', stroke: '#00ffff', strokeThickness: 10,
                    shadow: { blur: 10, color: '#000000', fill: true }
                }).setOrigin(0.5).setDepth(51).setScale(0);
                
                this.tweens.add({ targets: title, scale: 1, ease: 'Bounce.easeOut', duration: 800 });
                this.tweens.add({ targets: title, scale: 1.05, yoyo: true, repeat: -1, duration: 500, delay: 800 });

                this.add.text(cx, 400, 'DISTANCIA: ' + this.score + 'm', { fontSize: '24px', fontFamily: 'Arial Black', color: '#fff' }).setOrigin(0.5).setDepth(51);
                this.add.text(cx, 440, 'GEMAS: ' + this.gemCount, { fontSize: '24px', fontFamily: 'Arial Black', color: '#00ff00' }).setOrigin(0.5).setDepth(51);

                const btn = this.add.rectangle(cx, 550, 220, 60, 0x00ffff).setInteractive().setDepth(51);
                this.add.text(cx, 550, 'REINICIAR', { fontSize: '24px', fontFamily: 'Arial Black', color: '#2a004f' }).setOrigin(0.5).setDepth(52);
                this.tweens.add({ targets: btn, scale: 1.05, yoyo: true, repeat: -1, duration: 800 });

                btn.on('pointerdown', () => { audio.playScore(); this.scene.restart(); });
            }
        }

        // ========================================
        // 5. CONFIGURACI칍N E INICIO
        // ========================================
        const config = {
            type: Phaser.CANVAS,
            canvas: document.getElementById('game-canvas'),
            width: 450, height: 800,
            backgroundColor: '#0a0a0f',
            parent: 'game-wrapper',
            scene: [IntroScene, GameScene],
            scale: { mode: Phaser.Scale.FIT, autoCenter: Phaser.Scale.CENTER_BOTH }
        };

        const game = new Phaser.Game(config);

        let p = 0;
        const bar = document.getElementById('loading-bar');
        const txt = document.getElementById('loading-percent');
        const iv = setInterval(() => {
            p += 5 + Math.random()*10;
            if(p >= 100) {
                p=100; clearInterval(iv);
                setTimeout(() => {
                    document.getElementById('loading-screen').style.display = 'none';
                    document.getElementById('game-canvas').style.display = 'block';
                }, 200);
            }
            bar.style.width = p + '%';
            txt.innerText = Math.floor(p) + '%';
        }, 100);
        
        document.addEventListener('touchmove', e => e.preventDefault(), { passive: false });
    </script>
</body>
</html>